easyblock = 'ConfigureMake'

name = 'PaStiX'
version = '5.2.2.22'

homepage = 'http://pastix.gforge.inria.fr/'
description = """PaStiX (Parallel Sparse matriX package) is a scientific library that provides a high performance
 parallel solver for very large sparse linear systems based on direct methods."""

toolchain = {'name': 'goolf', 'version': '1.5.16'}
toolchainopts = {'pic': True}

source_urls = ['https://gforge.inria.fr/frs/download.php/file/35070/']
sources = ['%(namelower)s_%(version)s.tar.bz2']

patches = ['PaStiX-5.2.2.22_memory.patch']

checksums = [
    '30f771a666719e6b116f549a6e4da451beabab99c2ecabc0745247c3654acbed',  # pastix_5.2.2.22.tar.bz2
    '04e7674b89cac6a310fc45917b2cf88582ac1bd35b321832147a2b33457c02a0',  # PaStiX-5.2.2.22_memory.patch
]

dependencies = [
    ('hwloc', '1.8.1'),
    ('SCOTCH', '6.0.4'),
]

skipsteps = ['configure']

start_dir = 'src'

prebuildopts = "cp -a config/LINUX-GNU.in config.in && "
buildopts = 'BLASLIB="-L$BLAS_LIB_DIR $LIBBLAS" HWLOC_HOME=$EBROOTHWLOC SCOTCH_HOME=$EBROOTSCOTCH '
# take control over compiler flags
buildopts += 'CCFOPT="$CFLAGS -DMEMORY_USAGE -DWITH_SCOTCH" '

runtest = "examples && ./example/bin/simple -lap 100"

installopts = "PREFIX=%(installdir)s"

sanity_check_paths = {
    'files': ['bin/pastix-conf', 'lib/libmatrix_driver.a', 'lib/libpastix.a', 'lib/libpastix_murge.a'],
    'dirs': ['include'],
}

moduleclass = 'math'
