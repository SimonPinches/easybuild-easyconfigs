easyblock = 'CMakeMake'

name = 'UDA'
version = '2.6.0'

homepage = 'https://github.com/ukaea/UDA'
description = """Universal Data Access"""

toolchain = {'name': 'GCCcore', 'version': '10.2.0'}
toolchainopts = {'pic': True}

source_urls = ['https://github.com/ukaea/UDA/archive/refs/tags']
sources = ['%(version)s.tar.gz']
checksums = ['9fd8b917a4f6bc0eaadb04cc6b04fb98cebcdee7f5a31ec7bc2604839ca2e395']

builddependencies = [
    ('binutils', '2.35'),
    ('CMake', '3.18.4'),
    ('libMemcached', '1.0.18'),
    ('libtirpc', '1.3.1'),
]

dependencies = [
    ('libxml2', '2.9.10'),
    ('Boost', '1.74.0'),
    # OS dependency should be preferred if the os version is more recent then this version
    # it's nice to have an up to date openssl for security reasons
    # ('OpenSSL', '1.1.0e'),
]

osdependencies = [('openssl-devel', 'libssl-dev', 'libopenssl-devel')]

configopts = '-DCMAKE_BUILD_TYPE=Debug '
configopts += '-DBUILD_SHARED_LIBS=ON '
configopts += '-DBOOST_ROOT=${EBROOTBOOST} '

separate_build_dir = True

parallel = 1

# Specify UDA hostname and port

# modextravars = {
#     'UDA_HOST': '',
#     'UDA_PORT': '',
# }

modextrapaths = {
    'PYTHONPATH':  'include',
    'IDL_DLM_PATH': 'dlm',
    'IDL_PATH':     'idl',
    'PKG_CONFIG_PATH': 'etc',
}

sanity_check_paths = {
    'files': ['bin/uda_server',
              'bin/install_plugin',
              'lib/libfatuda_client.%s' % SHLIB_EXT,
              'lib/libuda_client.%s' % SHLIB_EXT,
              'lib/libuda_plugins.%s' % SHLIB_EXT,
              'lib/libuda_server.%s' % SHLIB_EXT, ],
    'dirs':  ['bin', 'etc/plugins', 'include/uda/plugins', 'lib/plugins', 'modulefiles', 'python_installer']
}

moduleclass = 'data'
